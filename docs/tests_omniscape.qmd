---
title: "Tests com Omniscape"
author: "Andrea Sánchez-Tapia"
date: today
date-format: medium
format:
  revealjs:
    incremental: false 
---

## Omniscape

<https://docs.circuitscape.org/Omniscape.jl/latest/usage/>

```{r}
knitr::include_graphics("https://docs.circuitscape.org/Omniscape.jl/latest/figs/moving_window.png")
```

## Resistência como distância

+ Isolamento por distância 
+ Modelagem de custo mínimo (Least-cost)
+ Mc Rae 2006, 2008: resistência como medida de isolamento. Caminhos como resistores conectados entre si 
  + Pixels mais próximos têm menor isolamento entre si
  + Várias conexões possíveis, não apenas as de mínimo custo
  + Existência de múltiplos caminhos possíveis diminui a resistência/distância

## Parâmetros

-   `resistance_file`: Caminho para o raster de resistência
-   `radius`: raio em pixels da janela movel para identificar fontes para o target pixel
-   `project_name`: nome do projeto
-   `source_from_resistance` uma camada source, só necessária se `source_from_resistance = false`.

## Output

+ `current density`: uma estimativa do fluxo de random walkers através de um grid de resistência 
+ `flow`: fluxo sem resistência (apenas a configuração espacial)
+ `normalized flow`: current density / flow

## Tests


-   radius = __100__, 200, 300 Raio _em número de pixeis_ para calcular a resistência de cada bloco central
-   block size = __5__, 11 Tamanho do bloco para agregar pixeis e diminuir custo computacional
-   resistance cutoff = __50__, 300 Valor de resistência a partir do qual não se esperam conexões (300 para conectar ~todo mundo)

## Mapa de resistência

```{r, echo=FALSE}

library(terra)
library(tmap)
res <- terra::rast("../scripts/2_omniscape_julia/resistencia_test_area.tif")
tmap_mode("view")
  tm_shape(res) + 
   tm_raster(palette = "Greens")
```


## Conectividade com Omniscape

```{r}
library(terra)
library(tmap)

currmap <- terra::rast("../scripts/2_omniscape_julia/output/test2_default_options/cum_currmap.tif")
currmap2 <- terra::rast("../scripts/2_omniscape_julia/output/test2_radius200/cum_currmap.tif")
currmap3 <- terra::rast("../scripts/2_omniscape_julia/output/test2_radius300/cum_currmap.tif")
currmap4 <- terra::rast("../scripts/2_omniscape_julia/output/test2_radius200_block10/cum_currmap.tif")
currmap5 <- terra::rast("../scripts/2_omniscape_julia/output/test2_rad100_block_5_cutoff300/cum_currmap.tif")
currmap6 <- terra::rast("../scripts/2_omniscape_julia/output/test2_rad200_block_5_cutoff300/cum_currmap.tif")
currmap7 <- terra::rast("../scripts/2_omniscape_julia/output/test2_rad300_block_5_cutoff300/cum_currmap.tif")
currmap8 <- terra::rast("../scripts/2_omniscape_julia/output/reclass_radius300/cum_currmap.tif")
```


```{r}
tmap_mode("view")
  tm_shape(res, name = "Resistencia") +
    tm_raster(palette = "Greens", style = "quantile") +
    tm_shape(currmap,
             name = "Block 5 Raio 100 Cutoff 50 "
             ) +
    tm_raster(palette = "Reds", style = "quantile") +
    tm_shape(currmap2,
             name = "Block 5 Raio 200 Cutoff 50 ") +
    tm_raster(palette = "Reds", style = "quantile") +
    tm_shape(currmap3,
             name = "Block 5 Raio 300 Cutoff 50 ") +
    tm_raster(palette = "Reds", style = "quantile") +
    tm_shape(currmap4,
             name = "Block 11 Raio 100 Cutoff 50 ") +
    tm_raster(palette = "Reds", style = "quantile") +
    tm_shape(currmap5,
             name = "Block 5 Raio 100 Cutoff 300") +
    tm_raster(palette = "Reds", style = "quantile") +
    tm_shape(currmap6,
             name = "Block 5 Raio 200 Cutoff 300") +
    tm_raster(palette = "Reds", style = "quantile") +
    tm_shape(currmap7,
             name = "Block 5 Raio 300 Cutoff 300") +
    tm_raster(palette = "Reds", style = "quantile") 
```


